{% extends 'curriculum/base.html' %}
{% load static %}

{% block title %}Servicios Profesionales - {{ perfil.nombres }}{% endblock %}

{% block content %}
<div class="min-h-screen py-20 relative z-10">
    
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
        <div class="absolute top-[20%] right-[30%] w-[700px] h-[700px] bg-[#BBD2D6]/10 blur-[120px] rounded-full"></div>
        <div class="absolute bottom-[10%] left-[10%] w-[400px] h-[400px] bg-[#5A7D84]/10 blur-[100px] rounded-full"></div>
    </div>

    <div class="max-w-7xl mx-auto px-6">

        <div class="text-center mb-20 fade-in">
            <div class="flex items-center justify-center gap-4 mb-6">
                <div class="h-1.5 w-16 bg-[#BBD2D6] rounded-full"></div>
                <span class="text-gray-400 font-black tracking-[0.2em] text-sm uppercase">Mis Servicios</span>
                <div class="h-1.5 w-16 bg-[#BBD2D6] rounded-full"></div>
            </div>
            
            <h1 class="text-4xl md:text-5xl font-black text-[#1a1a1a] mb-6 tracking-tighter">
                SERVICIOS <span class="text-transparent bg-clip-text bg-gradient-to-r from-[#5A7D84] to-[#1a1a1a] italic pr-4">PROFESIONALES</span>
            </h1>
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for item in servicios %}
            <article 
                onclick="openModal(
                    '{{ item.nombre_producto|escapejs }}', 
                    '{{ item.precio }}', 
                    '{{ item.descripcion|escapejs }}', 
                    '{% if item.imagen %}{{ item.imagen.url }}{% endif %}', 
                    '{{ item.estado }}', 
                    '{{ item.stock }}'
                )"
                class="bg-white p-8 rounded-[2.5rem] shadow-lg border border-gray-100 hover:shadow-2xl transition-all duration-500 hover:-translate-y-2 group relative overflow-hidden flex flex-col h-full cursor-pointer"
            >
                
                <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-[#BBD2D6] to-[#5A7D84] opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>

                <div class="mb-8 flex justify-between items-start">
                    <div class="w-16 h-16 bg-[#F0F4F5] rounded-2xl flex items-center justify-center text-[#5A7D84] group-hover:bg-[#5A7D84] group-hover:text-white transition-colors duration-500 shadow-sm overflow-hidden">
                        {% if item.imagen %}
                            <img src="{{ item.imagen.url }}" alt="{{ item.nombre_producto }}" class="w-full h-full object-cover">
                        {% else %}
                            <i data-lucide="package" class="w-8 h-8"></i>
                        {% endif %}
                    </div>
                    {% if item.precio %}
                    <span class="px-4 py-2 bg-[#1a1a1a] text-white text-sm font-black rounded-full shadow-md">
                        ${{ item.precio }}
                    </span>
                    {% endif %}
                </div>

                <h3 class="text-2xl font-black text-[#1a1a1a] mb-4 leading-tight group-hover:text-[#5A7D84] transition-colors">
                    {{ item.nombre_producto }}
                </h3>
                
                <div class="text-gray-600 text-sm leading-relaxed mb-8 flex-grow space-y-2">
                    {{ item.descripcion|linebreaks }}
                </div>
                
                <div class="mb-4">
                    <span class="text-[10px] font-black uppercase px-2.5 py-1 rounded-md shadow-sm
                        {% if item.estado == 'Nuevo' %} bg-blue-100 text-blue-700
                        {% elif item.estado == 'Bueno' %} bg-green-100 text-green-700
                        {% elif item.estado == 'Regular' %} bg-orange-100 text-orange-700
                        {% else %} bg-gray-100 text-gray-600 {% endif %}">
                        {{ item.estado }}
                    </span>

                    {% if item.stock > 0 %}
                    <span class="text-xs font-bold text-green-500 uppercase ml-2 italic">Disponible: {{ item.stock }}</span>
                    {% else %}
                    <span class="text-xs font-bold text-red-500 uppercase ml-2 italic">Agotado</span>
                    {% endif %}

                    <div class="text-[10px] text-gray-400 mt-3 flex items-center gap-1 font-medium">
                        <i data-lucide="calendar" class="w-3 h-3"></i>
                        Publicado el {{ item.fecha_publicacion|date:"d/m/Y" }}
                    </div>
                </div>

                <a href="https://wa.me/593998136345?text=Hola,%20me%20interesa:%20{{ item.nombre_producto }}" target="_blank" class="mt-auto w-full py-4 bg-[#F0F4F5] text-[#1a1a1a] font-black rounded-xl hover:bg-[#5A7D84] hover:text-white transition-all text-center uppercase tracking-widest text-xs flex items-center justify-center gap-2 group/btn">
                    Solicitar Info <i data-lucide="arrow-right" class="w-4 h-4 group-hover/btn:translate-x-1 transition-transform"></i>
                </a>

            </article>
            {% empty %}
            <div class="col-span-full py-20 text-center">
                <div class="inline-block p-6 rounded-full bg-gray-50 mb-6">
                    <i data-lucide="shopping-bag" class="w-12 h-12 text-gray-300"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-400">Próximamente</h3>
                <p class="text-gray-400 mt-2">Estamos preparando nuevos servicios para ti.</p>
            </div>
            {% endfor %}
        </div>

        <div class="mt-20 text-center">
            <a href="{% url 'inicio' %}" class="inline-flex items-center gap-2 text-gray-500 hover:text-[#5A7D84] font-bold transition-colors">
                <i data-lucide="arrow-left" class="w-4 h-4"></i> Volver al Inicio
            </a>
        </div>

    </div>

    <div id="productModal" class="fixed inset-0 z-[999] hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-[2.5rem] w-full max-w-md shadow-2xl overflow-hidden relative flex flex-col max-h-[90vh]">
                
                <button onclick="closeModal()" class="absolute top-5 left-5 p-2 bg-gray-100 rounded-full hover:bg-gray-200 z-20">
                    <i data-lucide="x" class="w-5 h-5 text-gray-600"></i>
                </button>

                <div class="absolute top-6 right-6 z-20">
                    <div class="bg-[#1a1a1a] text-white px-5 py-2 rounded-full shadow-lg border-2 border-white">
                        <span class="text-lg font-black tracking-tight">$<span id="modalPrice">0.00</span></span>
                    </div>
                </div>

                <div class="overflow-y-auto p-8 pt-16 scrollbar-hide">
                    <div class="w-full h-56 flex items-center justify-center mb-6 bg-gray-50 rounded-3xl p-4">
                        <img id="modalImage" src="" class="max-h-full object-contain drop-shadow-md hidden">
                        <div id="modalNoImage" class="hidden flex flex-col items-center text-gray-300">
                            <i data-lucide="image" class="w-16 h-16 mb-2"></i><span class="text-xs font-bold">Sin Imagen</span>
                        </div>
                    </div>

                    <h2 id="modalTitle" class="text-3xl font-black text-[#1a1a1a] leading-none mb-6">Titulo</h2>
                    
                    <div id="modalDescriptionContainer" class="space-y-3 mb-8"></div>

                    <div class="flex items-center gap-4 mb-8 text-xs font-bold uppercase tracking-widest border-t border-gray-100 pt-6">
                        <span class="text-gray-400">ESTADO: <span id="modalState" class="text-[#1a1a1a]">NUEVO</span></span>
                        <span class="text-green-500">DISPONIBLE: <span id="modalStock">0</span></span>
                    </div>

                    <a id="modalWhatsappLink" href="#" target="_blank" class="block w-full bg-[#1a1a1a] text-white hover:bg-[#5A7D84] text-center py-4 rounded-xl font-black text-sm transition-all flex items-center justify-center gap-2">
                        SOLICITAR INFO <i data-lucide="arrow-right" class="w-4 h-4"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function openModal(title, price, description, imageUrl, state, stock) {
        const modal = document.getElementById('productModal');
        document.getElementById('modalTitle').textContent = title;
        document.getElementById('modalPrice').textContent = price;
        document.getElementById('modalState').textContent = state;
        document.getElementById('modalStock').textContent = stock;

        const imgEl = document.getElementById('modalImage');
        const noImgEl = document.getElementById('modalNoImage');
        if (imageUrl && imageUrl !== 'None' && imageUrl !== '') {
            imgEl.src = imageUrl; imgEl.classList.remove('hidden'); noImgEl.classList.add('hidden');
        } else {
            imgEl.classList.add('hidden'); noImgEl.classList.remove('hidden');
        }

        const descContainer = document.getElementById('modalDescriptionContainer');
        descContainer.innerHTML = ''; 
        description.split('\n').forEach(line => {
            if(line.trim() !== '') {
                descContainer.innerHTML += `
                    <div class="flex items-start gap-3">
                        <div class="mt-0.5 min-w-[20px]"><div class="w-5 h-5 bg-[#22C55E] rounded-[4px] flex items-center justify-center shadow-sm"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg></div></div>
                        <p class="text-gray-600 text-sm font-medium leading-relaxed">${line}</p>
                    </div>`;
            }
        });

        // Usamos el número que ya tenías fijo en tu código
        const cleanPhone = "593998136345"; 
        document.getElementById('modalWhatsappLink').href = `https://wa.me/${cleanPhone}?text=Hola, me interesa: ${encodeURIComponent(title)}`;
        
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden'; 
        if(typeof lucide !== 'undefined') lucide.createIcons();
    }

    function closeModal() {
        document.getElementById('productModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
    }
</script>
{% endblock %}